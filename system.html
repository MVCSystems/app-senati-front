<!doctype html>
<html lang="es" class="h-100">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema MFA - Autenticación Segura</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  </head>
  <body class="d-flex flex-column h-100" style="background: linear-gradient(to bottom, #f4f6ff 0%, #ffffff 100%);">
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container-fluid px-4">
        <a class="navbar-brand fw-bold fs-4" href="/" style="background: linear-gradient(135deg, #1864ff 0%, #083595 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
          <i class="bi bi-shield-shaded me-2" style="color: #1864ff; -webkit-text-fill-color: #1864ff;"></i>MFA Secure
        </a>
        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/"><i class="bi bi-house-door me-1"></i>Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="quickStart"><i class="bi bi-question-circle me-1"></i>Ayuda</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-shrink-0">
      <div class="container py-5">
        
        <!-- Hero Badge -->
        <div class="text-center mb-4">
          <span class="badge px-4 py-2 rounded-pill shadow-sm" style="background: linear-gradient(135deg, #1864ff 0%, #083595 100%); color: white;">
            <i class="bi bi-shield-check me-2"></i>
            Sistema de Autenticación Multifactor
          </span>
        </div>

        <!-- Main Card -->
        <div class="row justify-content-center">
          <div class="col-xl-7 col-lg-8 col-md-10">
            
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
              
              <!-- Card Header -->
              <div class="card-header border-0 p-4" style="background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
                <div class="text-center text-white">
                  <div class="bg-white bg-opacity-25 rounded-circle d-inline-flex p-4 mb-3">
                    <i class="bi bi-shield-lock-fill" style="font-size: 3rem;"></i>
                  </div>
                  <h2 class="fw-bold mb-2">Verificación de Identidad</h2>
                  <p class="mb-0 opacity-75">Complete los siguientes pasos para acceder de forma segura</p>
                </div>
              </div>

              <!-- Progress Steps -->
              <div class="card-body bg-light p-4">
                <div id="mfa_stepper" class="row text-center g-3 mb-4">
                  
                  <div class="col-4" data-step="1">
                    <div class="position-relative">
                      <div class="bg-white rounded-3 p-3 shadow-sm h-100">
                        <div class="mb-2">
                          <div class="badge bg-secondary rounded-circle p-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="bi bi-person-lock"></i>
                          </div>
                        </div>
                        <h6 class="fw-bold mb-1">Paso 1</h6>
                        <small class="text-muted">Credenciales</small>
                      </div>
                    </div>
                  </div>

                  <div class="col-4" data-step="2">
                    <div class="position-relative">
                      <div class="bg-white rounded-3 p-3 shadow-sm h-100">
                        <div class="mb-2">
                          <div class="badge bg-secondary rounded-circle p-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="bi bi-phone-vibrate"></i>
                          </div>
                        </div>
                        <h6 class="fw-bold mb-1">Paso 2</h6>
                        <small class="text-muted">Código TOTP</small>
                      </div>
                    </div>
                  </div>

                  <div class="col-4" data-step="3">
                    <div class="position-relative">
                      <div class="bg-white rounded-3 p-3 shadow-sm h-100">
                        <div class="mb-2">
                          <div class="badge bg-secondary rounded-circle p-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="bi bi-envelope-at"></i>
                          </div>
                        </div>
                        <h6 class="fw-bold mb-1">Paso 3</h6>
                        <small class="text-muted">Email OTP</small>
                      </div>
                    </div>
                  </div>

                </div>

                <!-- Progress Bar -->
                <div class="progress mb-4" style="height: 8px;">
                  <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%; background: linear-gradient(90deg, #1864ff 0%, #083595 100%);"></div>
                </div>

                <!-- App Container -->
                <div id="app">
                  <div class="text-center py-5">
                    <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="text-muted fw-semibold">Inicializando sistema de seguridad...</p>
                  </div>
                </div>
              </div>

              <!-- Card Footer -->
              <div class="card-footer bg-white border-0 p-4">
                <div class="d-flex align-items-center justify-content-center gap-2 text-muted small">
                  <i class="bi bi-shield-fill-check" style="color: #1864ff;"></i>
                  <span>Conexión segura SSL/TLS</span>
                  <span class="mx-2">•</span>
                  <i class="bi bi-key-fill" style="color: #083595;"></i>
                  <span>Cifrado de extremo a extremo</span>
                </div>
              </div>

            </div>

            <!-- Feature Cards -->
            <div class="row g-3 mt-4">
              <div class="col-md-4">
                <div class="card border-0 bg-white shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="rounded-circle d-inline-flex p-3 mb-3" style="background: linear-gradient(135deg, rgba(24,100,255,0.1) 0%, rgba(8,53,149,0.1) 100%);">
                      <i class="bi bi-shield-check fs-3" style="color: #1864ff;"></i>
                    </div>
                    <h6 class="fw-bold">Máxima Seguridad</h6>
                    <small class="text-muted">Triple capa de autenticación</small>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card border-0 bg-white shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="rounded-circle d-inline-flex p-3 mb-3" style="background: linear-gradient(135deg, rgba(24,100,255,0.1) 0%, rgba(8,53,149,0.1) 100%);">
                      <i class="bi bi-lightning-charge fs-3" style="color: #083595;"></i>
                    </div>
                    <h6 class="fw-bold">Acceso Rápido</h6>
                    <small class="text-muted">Verificación en segundos</small>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card border-0 bg-white shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="rounded-circle d-inline-flex p-3 mb-3" style="background: linear-gradient(135deg, rgba(24,100,255,0.1) 0%, rgba(8,53,149,0.1) 100%);">
                      <i class="bi bi-patch-check fs-3" style="color: #1864ff;"></i>
                    </div>
                    <h6 class="fw-bold">100% Confiable</h6>
                    <small class="text-muted">Tecnología probada</small>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="mt-auto py-4 text-white" style="background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
            <h6 class="mb-1 fw-bold">
              <i class="bi bi-shield-shaded me-2"></i>MFA Secure System
            </h6>
            <small class="text-white opacity-75">
              <i class="bi bi-mortarboard me-1"></i>Proyecto Académico de Seguridad Informática
            </small>
          </div>
          <div class="col-md-6 text-center text-md-end">
            <div class="d-flex justify-content-center justify-content-md-end gap-2 flex-wrap">
              <span class="badge bg-white text-primary">JWT</span>
              <span class="badge bg-white text-primary">TOTP</span>
              <span class="badge bg-white text-primary">Email OTP</span>
              <span class="badge bg-white text-primary">3-Layer</span>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg rounded-4">
          <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
            <h5 class="modal-title fw-bold">
              <i class="bi bi-info-circle-fill me-2"></i>¿Cómo funciona el sistema MFA?
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-4">
            
            <div class="alert border-0 mb-4" style="background: linear-gradient(135deg, rgba(24,100,255,0.1) 0%, rgba(8,53,149,0.1) 100%); color: #083595;">
              <i class="bi bi-lightbulb-fill me-2"></i>
              <strong>MFA (Multi-Factor Authentication)</strong> añade capas adicionales de seguridad más allá de solo una contraseña.
            </div>

            <div class="row g-3">
              <div class="col-12">
                <div class="d-flex align-items-start gap-3 p-3 bg-light rounded-3">
                  <div class="text-white rounded-circle d-flex align-items-center justify-content-center" style="min-width: 50px; height: 50px; font-size: 1.5rem; background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
                    <i class="bi bi-person-lock"></i>
                  </div>
                  <div>
                    <h6 class="fw-bold mb-1">1. Credenciales de Acceso</h6>
                    <p class="text-muted mb-0 small">Ingresa tu nombre de usuario y contraseña. Este es el primer factor de autenticación basado en algo que <strong>conoces</strong>.</p>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="d-flex align-items-start gap-3 p-3 bg-light rounded-3">
                  <div class="text-white rounded-circle d-flex align-items-center justify-content-center" style="min-width: 50px; height: 50px; font-size: 1.5rem; background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
                    <i class="bi bi-phone-vibrate"></i>
                  </div>
                  <div>
                    <h6 class="fw-bold mb-1">2. Código TOTP (Authenticator)</h6>
                    <p class="text-muted mb-0 small">Ingresa el código de 6 dígitos desde tu aplicación móvil (Google Authenticator, Authy, etc). Segundo factor basado en algo que <strong>tienes</strong>.</p>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="d-flex align-items-start gap-3 p-3 bg-light rounded-3">
                  <div class="text-white rounded-circle d-flex align-items-center justify-content-center" style="min-width: 50px; height: 50px; font-size: 1.5rem; background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
                    <i class="bi bi-envelope-at"></i>
                  </div>
                  <div>
                    <h6 class="fw-bold mb-1">3. Código por Email (OTP)</h6>
                    <p class="text-muted mb-0 small">Revisa tu correo electrónico y ingresa el código OTP que recibiste. Tercer factor de verificación adicional.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="alert alert-success border-0 mt-4 mb-0">
              <i class="bi bi-patch-check-fill me-2"></i>
              <strong>¿Perdiste tu teléfono?</strong> Puedes usar los códigos de respaldo que recibiste al registrarte.
            </div>

          </div>
          <div class="modal-footer border-0 bg-light">
            <button type="button" class="btn btn-primary px-4" data-bs-dismiss="modal">
              <i class="bi bi-check-circle me-1"></i>Entendido
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Outbox Modal -->
    <div class="modal fade" id="outboxModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg rounded-4">
          <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #1864ff 0%, #083595 100%);">
            <h5 class="modal-title fw-bold">
              <i class="bi bi-envelope-open-fill me-2"></i>Outbox - Códigos Enviados
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-4">
            <div class="alert alert-info border-0">
              <i class="bi bi-info-circle-fill me-2"></i>
              Modo debug: Códigos OTP que serían enviados por email
            </div>
            <pre id="outboxContent" class="bg-dark text-white p-3 rounded-3 border-0" style="max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace;"></pre>
          </div>
          <div class="modal-footer border-0 bg-light">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Guardar íconos originales
      const stepIcons = {
        1: 'bi-person-lock',
        2: 'bi-phone-vibrate',
        3: 'bi-envelope-at'
      };
      
      // Stepper management
      function setStepActive(n) {
        const steps = document.querySelectorAll('#mfa_stepper [data-step]');
        steps.forEach((step) => {
          const stepNum = parseInt(step.getAttribute('data-step'));
          const badge = step.querySelector('.badge');
          const card = step.querySelector('.bg-white');
          const title = step.querySelector('h6');
          const icon = badge.querySelector('i');
          
          // Remover clases de color anteriores
          badge.classList.remove('bg-primary', 'bg-success', 'bg-secondary');
          title.classList.remove('text-primary', 'text-success', 'text-muted');
          card.classList.remove('border', 'border-primary', 'border-3');
          
          if (stepNum === n) {
            // Paso activo - azul
            badge.classList.add('bg-primary');
            title.classList.add('text-primary');
            card.classList.add('border', 'border-primary', 'border-3');
            // Restaurar ícono original si fue cambiado
            if (icon && !icon.classList.contains(stepIcons[stepNum])) {
              icon.className = stepIcons[stepNum];
            }
          } else if (stepNum < n) {
            // Paso completado - verde con check
            badge.classList.add('bg-success');
            title.classList.add('text-success');
            if (icon) {
              icon.className = 'bi bi-check-lg';
            }
          } else {
            // Paso pendiente - gris
            badge.classList.add('bg-secondary');
            title.classList.add('text-muted');
            // Restaurar ícono original
            if (icon && !icon.classList.contains(stepIcons[stepNum])) {
              icon.className = stepIcons[stepNum];
            }
          }
        });
        
        // Update progress bar
        const progress = ((n - 1) / 3) * 100;
        const progressBar = document.getElementById('progress-bar');
        if (progressBar) {
          progressBar.style.width = progress + '%';
        }
      }
      
      function setStepCompleted(n) {
        const step = document.querySelector(`#mfa_stepper [data-step="${n}"]`);
        if (step) {
          const badge = step.querySelector('.badge');
          const title = step.querySelector('h6');
          const icon = badge.querySelector('i');
          
          badge.classList.remove('bg-primary', 'bg-secondary');
          badge.classList.add('bg-success');
          title.classList.remove('text-primary', 'text-muted');
          title.classList.add('text-success');
          
          if (icon) {
            icon.className = 'bi bi-check-lg';
          }
        }
        
        // Actualizar barra de progreso
        const progress = (n / 3) * 100;
        const progressBar = document.getElementById('progress-bar');
        if (progressBar) {
          progressBar.style.width = progress + '%';
        }
      }
      
      // Help modal
      document.getElementById('quickStart')?.addEventListener('click', (e) => {
        e.preventDefault();
        new bootstrap.Modal(document.getElementById('helpModal')).show();
      });
    </script>
    <script src="/app.js"></script>
  </body>
</html>
